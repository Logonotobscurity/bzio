{
  "audit_metadata": {
    "timestamp": "2025-01-XX",
    "repository": "bzionu",
    "auditor": "Amazon Q",
    "total_files_analyzed": 250
  },
  "critical_issues": [
    {
      "type": "SECURITY",
      "severity": "HIGH",
      "file": "src/app/api/user/cart/items/[id]/route.ts",
      "line": 81,
      "issue": "Variable shadowing: 'itemId' declared twice in DELETE handler",
      "impact": "Logic error - uses params.id instead of destructured itemId"
    },
    {
      "type": "DUPLICATE_PRISMA_CLIENT",
      "severity": "HIGH",
      "files": ["src/lib/prisma.ts", "src/lib/db/index.ts"],
      "issue": "Two different Prisma client configurations exist",
      "impact": "Connection pool conflicts, inconsistent database access"
    }
  ],
  "files": [
    {
      "path": "src/app/api/user/cart/items/[id]/route.ts",
      "type": "api",
      "lines": 108,
      "client_server": "server",
      "notes": "BUG: Line 81 variable shadowing - itemId redeclared, uses wrong variable"
    },
    {
      "path": "src/services/analytics.service.ts",
      "type": "service",
      "lines": 120,
      "client_server": "server",
      "notes": "Class-based service with repository pattern"
    },
    {
      "path": "src/services/analyticsService.ts",
      "type": "service",
      "lines": 28,
      "client_server": "server",
      "notes": "DUPLICATE: Function-based analytics with Prisma direct access"
    },
    {
      "path": "src/lib/analytics.ts",
      "type": "util",
      "lines": 180,
      "client_server": "server",
      "notes": "DUPLICATE: Fire-and-forget analytics tracking utility"
    },
    {
      "path": "src/services/error-logging.service.ts",
      "type": "service",
      "lines": 200,
      "client_server": "server",
      "notes": "Class-based error logging with repository pattern"
    },
    {
      "path": "src/services/errorLoggingService.ts",
      "type": "service",
      "lines": 95,
      "client_server": "server",
      "notes": "DUPLICATE: Function-based error logging with Prisma direct"
    },
    {
      "path": "src/services/notification.service.ts",
      "type": "service",
      "lines": 150,
      "client_server": "server",
      "notes": "Admin notification service with repository pattern"
    },
    {
      "path": "src/services/notificationService.ts",
      "type": "service",
      "lines": 30,
      "client_server": "server",
      "notes": "DUPLICATE: User notification service with Prisma direct"
    },
    {
      "path": "src/services/quote.service.ts",
      "type": "service",
      "lines": 220,
      "client_server": "server",
      "notes": "Class-based quote service with validation"
    },
    {
      "path": "src/services/quoteService.ts",
      "type": "service",
      "lines": 65,
      "client_server": "server",
      "notes": "DUPLICATE: Transaction-based quote creation"
    },
    {
      "path": "src/components/brand-card.tsx",
      "type": "component",
      "lines": 50,
      "client_server": "client",
      "notes": "Brand card with schema type"
    },
    {
      "path": "src/components/BrandCard.tsx",
      "type": "component",
      "lines": 70,
      "client_server": "client",
      "notes": "DUPLICATE: Brand card with enriched data"
    },
    {
      "path": "src/components/ui/brand-card.tsx",
      "type": "component",
      "lines": 60,
      "client_server": "client",
      "notes": "DUPLICATE: Brand card in UI folder"
    },
    {
      "path": "src/lib/auth.ts",
      "type": "util",
      "lines": 6,
      "client_server": "server",
      "notes": "Re-exports from root auth.ts"
    },
    {
      "path": "src/lib/auth-utils.ts",
      "type": "util",
      "lines": 180,
      "client_server": "server",
      "notes": "Server-side auth utilities with role checks"
    },
    {
      "path": "src/lib/admin-auth.ts",
      "type": "util",
      "lines": 250,
      "client_server": "server",
      "notes": "Admin-specific auth utilities"
    },
    {
      "path": "auth.ts",
      "type": "config",
      "lines": 180,
      "client_server": "server",
      "notes": "NextAuth configuration at root"
    },
    {
      "path": "middleware.ts",
      "type": "middleware",
      "lines": 180,
      "client_server": "server",
      "notes": "Role-based routing middleware"
    },
    {
      "path": "src/lib/prisma.ts",
      "type": "config",
      "lines": 18,
      "client_server": "server",
      "notes": "Simple Prisma client singleton"
    },
    {
      "path": "src/lib/db/index.ts",
      "type": "config",
      "lines": 45,
      "client_server": "server",
      "notes": "DUPLICATE: Prisma with PG adapter and pool"
    },
    {
      "path": "src/services/productService.ts",
      "type": "service",
      "lines": 280,
      "client_server": "server",
      "notes": "Comprehensive product service with caching"
    },
    {
      "path": "src/lib/product-utils.ts",
      "type": "util",
      "lines": 15,
      "client_server": "server",
      "notes": "Product normalization utilities"
    },
    {
      "path": "src/app/admin/login/page.tsx",
      "type": "page",
      "lines": 50,
      "client_server": "server",
      "notes": "Admin login page"
    },
    {
      "path": "src/app/auth/admin/login/page.tsx",
      "type": "page",
      "lines": 50,
      "client_server": "server",
      "notes": "DUPLICATE: Admin login at different path"
    },
    {
      "path": "src/app/login/page.tsx",
      "type": "page",
      "lines": 40,
      "client_server": "server",
      "notes": "Login selection page"
    },
    {
      "path": "src/app/login/customer/page.tsx",
      "type": "page",
      "lines": 40,
      "client_server": "server",
      "notes": "Customer login page"
    },
    {
      "path": "src/app/auth/customer/login/page.tsx",
      "type": "page",
      "lines": 40,
      "client_server": "server",
      "notes": "DUPLICATE: Customer login at different path"
    }
  ],
  "summary": {
    "total_duplicates": 15,
    "high_priority_issues": 3,
    "medium_priority_issues": 12,
    "low_priority_issues": 8,
    "mislocated_files": 5,
    "routing_conflicts": 4
  }
}
