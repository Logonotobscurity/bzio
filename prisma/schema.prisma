generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model addresses {
  id            Int         @id @default(autoincrement())
  type          AddressType @default(BILLING)
  label         String?
  contactPerson String?
  phone         String?
  addressLine1  String
  addressLine2  String?
  city          String
  state         String
  postalCode    String
  country       String      @default("Nigeria")
  isDefault     Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  userId        Int?
  companyId     Int?
  companies     BusinessAccount?  @relation(fields: [companyId], references: [id])
  users         users?            @relation(fields: [userId], references: [id])
}

model admin_notifications {
  id        Int                   @id @default(autoincrement())
  adminId   Int
  title     String
  message   String
  type      AdminNotificationType @default(INFO)
  link      String?
  isRead    Boolean               @default(false)
  data      Json?
  createdAt DateTime              @default(now())
  updatedAt DateTime              @updatedAt

  @@index([adminId])
  @@index([createdAt])
  @@index([isRead])
  @@index([type])
}

model analytics_events {
  id        Int      @id @default(autoincrement())
  eventType String
  eventData Json?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  userId    Int?
  users     users?   @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([eventType])
  @@index([userId])
}

model brands {
  id          Int        @id @default(autoincrement())
  name        String     @unique
  slug        String     @unique
  description String?
  logo        String?
  website     String?
  isActive    Boolean    @default(true)
  isFeatured  Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  products    products[]
}

model cart_items {
  id        Int      @id @default(autoincrement())
  quantity  Int
  unitPrice Decimal?
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    Int
  productId Int
  cartId    Int?
  cart      carts?   @relation(fields: [cartId], references: [id])
  products  products @relation(fields: [productId], references: [id])
  users     users    @relation(fields: [userId], references: [id])

  @@unique([userId, productId])
}

model categories {
  id               Int          @id @default(autoincrement())
  name             String       @unique
  slug             String       @unique
  description      String?
  image            String?
  isActive         Boolean      @default(true)
  sortOrder        Int          @default(0)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  parentId         Int?
  categories       categories?  @relation("categoriesTocategories", fields: [parentId], references: [id])
  other_categories categories[] @relation("categoriesTocategories")
  products         products[]
}

model BusinessAccount {
  id                 Int         @id @default(autoincrement())
  name               String
  slug               String?     @unique
  registrationNumber String?
  taxId              String?
  industry           String?
  website            String?
  description        String?
  logo               String?
  isVerified         Boolean     @default(false)
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt
  addresses          addresses[]
  users              users[]

  @@map("companies")
}

model form_submissions {
  id        Int                  @id @default(autoincrement())
  formType  String
  data      Json
  email     String?
  status    FormSubmissionStatus @default(NEW)
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  userId    Int?
  users     users?               @relation(fields: [userId], references: [id])
}

model leads {
  id        Int        @id @default(autoincrement())
  email     String
  firstName String?
  lastName  String?
  company   String?
  phone     String?
  source    LeadSource @default(WEBSITE)
  status    LeadStatus @default(NEW)
  score     Int        @default(0)
  notes     String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model newsletter_subscribers {
  id             Int       @id @default(autoincrement())
  email          String    @unique
  firstName      String?
  lastName       String?
  isActive       Boolean   @default(true)
  status         String    @default("active")
  source         String?
  subscribedAt   DateTime  @default(now())
  unsubscribedAt DateTime?
}

model notification_preferences {
  id                 Int      @id @default(autoincrement())
  emailNotifications Boolean  @default(true)
  marketingEmails    Boolean  @default(false)
  quoteUpdates       Boolean  @default(true)
  productAlerts      Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  userId             Int      @unique
  users              users    @relation(fields: [userId], references: [id])
}

model notifications {
  id        Int              @id @default(autoincrement())
  title     String?
  message   String
  type      NotificationType @default(INFO)
  link      String?
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  userId    Int
  users     users            @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([isRead])
  @@index([userId])
}

model product_views {
  id        Int      @id @default(autoincrement())
  viewedAt  DateTime @default(now())
  userId    Int?
  productId Int
  products  products @relation(fields: [productId], references: [id])
  users     users?   @relation(fields: [userId], references: [id])
}

model products {
  id                  Int               @id @default(autoincrement())
  name                String
  description         String?
  sku                 String            @unique
  price               Decimal           @db.Decimal(10, 2)
  costPrice           Decimal?          @db.Decimal(10, 2)
  compareAtPrice      Decimal?          @db.Decimal(10, 2)
  weight              Decimal?          @db.Decimal(8, 3)
  dimensions          String?
  imageUrl            String?
  images              String[]          @default([])
  isActive            Boolean           @default(true)
  isFeatured          Boolean           @default(false)
  stockQuantity       Int               @default(0)
  minOrderQty         Int               @default(1)
  maxOrderQty         Int?
  tags                String[]          @default([])
  metaTitle           String?
  metaDescription     String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  brandId             Int
  categoryId          Int
  detailedDescription String?
  slug                String            @unique
  specifications      Json?
  unit                String?           @default("Unit")
  cart_items          cart_items[]
  product_views       product_views[]
  brands              brands            @relation(fields: [brandId], references: [id])
  categories          categories        @relation(fields: [categoryId], references: [id])
  quote_lines         quote_lines[]
  stock_movements     stock_movements[]

  @@index([brandId])
  @@index([categoryId])
  @@index([createdAt])
  @@index([isActive])
  @@index([isFeatured])
}

model quote_lines {
  id         Int      @id @default(autoincrement())
  quantity   Int
  unitPrice  Decimal? @db.Decimal(10, 2)
  totalPrice Decimal? @db.Decimal(12, 2)
  notes      String?
  quoteId    Int
  productId  Int
  products   products @relation(fields: [productId], references: [id])
  quotes     quotes   @relation(fields: [quoteId], references: [id])
}

model quote_messages {
  id              Int      @id @default(autoincrement())
  message         String
  senderRole      String   @default("customer")
  senderEmail     String?
  senderName      String?
  senderId        Int?
  isRead          Boolean  @default(false)
  direction       String?  @default("inbound")
  channel         String?  @default("web")
  fromNumber      String?
  vendorMessageId String?
  status          String?  @default("sent")
  metadata        Json?
  createdAt       DateTime @default(now())
  quoteId         Int
  quotes          quotes   @relation(fields: [quoteId], references: [id])
}

model quotes {
  id              Int              @id @default(autoincrement())
  reference       String           @unique
  status          QuoteStatus      @default(DRAFT)
  totalAmount     Decimal          @db.Decimal(12, 2)
  notes           String?
  internalNotes   String?
  validUntil      DateTime?
  acceptedAt      DateTime?
  rejectedAt      DateTime?
  rejectionReason String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  userId          Int?
  quote_lines     quote_lines[]
  quote_messages  quote_messages[]
  users           users?           @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model search_queries {
  id        Int      @id @default(autoincrement())
  query     String
  results   Int      @default(0)
  createdAt DateTime @default(now())
  userId    Int?
  users     users?   @relation(fields: [userId], references: [id])
}

model stock_movements {
  id        Int               @id @default(autoincrement())
  type      StockMovementType
  quantity  Int
  reason    String?
  reference String?
  createdAt DateTime          @default(now())
  productId Int
  products  products          @relation(fields: [productId], references: [id])
}

model users {
  id                       Int                       @id @default(autoincrement())
  email                    String                    @unique
  password                 String
  firstName                String?
  lastName                 String?
  companyName              String?
  companyPhone             String?
  businessType             String?
  businessRegistration     String?
  phone                    String?
  role                     UserRole                  @default(CUSTOMER)
  emailVerified            DateTime?
  emailVerificationToken   String?
  passwordResetToken       String?
  passwordResetExpires     DateTime?
  isActive                 Boolean                   @default(true)
  isNewUser                Boolean                   @default(true)
  lastLogin                DateTime?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  companyId                Int?
  addresses                addresses[]
  analytics_events         analytics_events[]
  cart_items               cart_items[]
  form_submissions         form_submissions[]
  notification_preferences notification_preferences?
  notifications            notifications[]
  product_views            product_views[]
  quotes                   quotes[]
  search_queries           search_queries[]
  companies                BusinessAccount?          @relation(fields: [companyId], references: [id])
  user_activities          user_activities[]
  carts                    carts[]

  @@index([createdAt])
  @@index([isActive])
  @@index([role])
}

model error_logs {
  id          Int      @id @default(autoincrement())
  message     String
  stack       String?
  context     Json?
  severity    String
  url         String
  userAgent   String
  sessionId   String
  userId      String?
  breadcrumbs Json?
  environment String
  version     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([createdAt])
  @@index([severity])
}

model user_activities {
  id            Int      @id @default(autoincrement())
  userId        Int
  activityType  String
  title         String?
  description   String
  metadata      Json?
  referenceId   String?
  referenceType String?
  createdAt     DateTime @default(now())
  users         users    @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([userId])
}

model crm_notifications {
  id           Int      @id @default(autoincrement())
  type         String
  targetSystem String
  priority     String   @default("MEDIUM")
  data         Json
  read         Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([createdAt])
  @@index([read])
}

model carts {
  id        Int          @id @default(autoincrement())
  userId    Int
  status    String       @default("active")
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  users     users        @relation(fields: [userId], references: [id])
  items     cart_items[]
}

enum AddressType {
  BILLING
  SHIPPING
}

enum AdminNotificationType {
  NEW_USER
  NEW_QUOTE
  LOW_STOCK
  SYSTEM_ALERT
  INFO
}

enum FormSubmissionStatus {
  NEW
  READ
  RESPONDED
}

enum LeadSource {
  WEBSITE
  EMAIL
  PHONE
  REFERRAL
  SOCIAL
  OTHER
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  CONVERTED
  LOST
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
}

enum QuoteStatus {
  DRAFT
  PENDING
  NEGOTIATING
  ACCEPTED
  REJECTED
  EXPIRED
}

enum StockMovementType {
  IN
  OUT
  ADJUSTMENT
}

enum UserRole {
  ADMIN
  CUSTOMER
}
